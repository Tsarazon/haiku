# План миграции .rdef файлов с Jam на Meson

## Цель
Заменить обработку .rdef файлов из Haiku Jam системы на Meson custom_target для генерации resource object files.

## Поэтапный план выполнения

### Этап 1: Исследование и анализ
**Промпт для себя**: "Изучи как Jam обрабатывает .rdef файлы в системе сборки Haiku. Найди примеры использования в исходном коде, определи входные и выходные файлы, аргументы инструментов."

**Задачи:**
1. Найти примеры использования .rdef в Jamfiles
2. Определить инструменты: rc, xres или другие
3. Изучить аргументы командной строки
4. Понять формат выходных файлов (.rsrc, .o, etc.)

### Этап 2: Поиск и анализ инструментов
**Промпт для себя**: "Найди исполняемые файлы rc, xres в системе Haiku. Изучи их справку (--help, man pages). Определи точный синтаксис команд для обработки .rdef файлов."

**Задачи:**
1. Локализовать инструменты обработки ресурсов
2. Изучить синтаксис и опции
3. Определить зависимости (заголовочные файлы, библиотеки)
4. Понять как генерируются объектные файлы

### Этап 3: Создание Meson custom_target
**Промпт для себя**: "Реализуй Meson custom_target который вызывает найденный инструмент обработки ресурсов. Создай функцию которая принимает .rdef файл и возвращает объектный файл для линковки."

**Задачи:**
1. Написать custom_target с правильными аргументами
2. Настроить зависимости (depends, depend_files)
3. Обеспечить корректные пути к инструментам
4. Добавить обработку ошибок

### Этап 4: Интеграция с приложением
**Промпт для себя**: "Создай тестовое приложение которое использует resource object file через objects: []. Убедись что ресурсы правильно линкуются и доступны в рантайме."

**Задачи:**
1. Создать простое приложение
2. Подключить resource object через objects: []
3. Добавить код для доступа к ресурсам
4. Проверить что ресурсы загружаются

### Этап 5: Тестирование и валидация
**Промпт для себя**: "Протестируй полный цикл: meson setup + ninja должен создать resource object file и приложение должно успешно запускаться с доступом к ресурсам."

**Задачи:**
1. Автоматизированное тестирование сборки
2. Проверка существования .o файлов
3. Валидация работы приложения
4. Проверка доступности ресурсов в рантайме

## Набор промптов для выполнения

### Промпт 1: Исследование Jam системы
"Найди в исходном коде Haiku все использования .rdef файлов в Jamfiles. Покажи примеры правил обработки ресурсов. Определи какие инструменты используются и с какими аргументами."

### Промпт 2: Анализ инструментов
"Найди исполняемые файлы для обработки ресурсов в Haiku (rc, xres и т.д.). Изучи их командную строку и опции. Покажи примеры команд для конвертации .rdef в объектные файлы."

### Промпт 3: Реализация custom_target
"Создай Meson custom_target функцию process_rdef_resources() которая:
- Принимает .rdef файл как вход
- Вызывает инструмент обработки ресурсов
- Генерирует .o объектный файл
- Возвращает объект для использования в objects: []"

### Промпт 4: Создание тестового приложения
"Создай минимальное Haiku приложение которое:
- Использует resource object file через objects: []
- Содержит код для загрузки ресурсов
- Демонстрирует работу с embedded ресурсами
- Компилируется и запускается через Meson"

### Промпт 5: Полная интеграция и тест
"Создай полный пример с meson.build который:
- Обрабатывает .rdef файл через custom_target
- Линкует resource object с приложением
- Тестируется командами: meson setup builddir && ninja -C builddir
- Результат: работающее приложение с ресурсами"

## Критерии успеха

1. ✅ custom_target успешно вызывает инструмент обработки ресурсов
2. ✅ Генерируется валидный .o файл из .rdef
3. ✅ Resource object успешно линкуется с приложением
4. ✅ meson setup + ninja создает исполняемый файл
5. ✅ Приложение запускается и может получить доступ к ресурсам
6. ✅ Процесс воспроизводим и работает на разных архитектурах

## Ожидаемые файлы результата

- `meson.build` - с рабочим custom_target
- `test_app.rdef` - пример ресурсного файла
- `main.cpp` - тестовое приложение
- `README.md` - инструкции по использованию
- Тесты для валидации процесса